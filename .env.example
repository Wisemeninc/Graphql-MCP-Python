# ============================================================================
# TLS Configuration (Optional - Traefik with Let's Encrypt)
# ============================================================================
# To enable TLS, run: docker compose --profile tls up -d

# Your domain name (required for TLS)
DOMAIN=example.com

# Let's Encrypt email for certificate notifications
ACME_EMAIL=admin@example.com

# Cloudflare DNS API credentials for DNS-01 challenge
# Create an API token at: https://dash.cloudflare.com/profile/api-tokens
# Required permissions: Zone:DNS:Edit
CF_API_EMAIL=your-cloudflare-email@example.com
CF_DNS_API_TOKEN=your-cloudflare-dns-api-token

# Traefik dashboard authentication (htpasswd format)
# Generate with: htpasswd -nb admin yourpassword
TRAEFIK_DASHBOARD_AUTH=admin:$$apr1$$xyz...

# Traefik log level (DEBUG, INFO, WARN, ERROR)
TRAEFIK_LOG_LEVEL=INFO

# ============================================================================
# GraphQL Endpoint (required for main service)
# ============================================================================
GRAPHQL_ENDPOINT=https://api.example.com/graphql

# Authentication token (optional)
GRAPHQL_AUTH_TOKEN=your_bearer_token_here

# Custom headers as JSON (optional)
GRAPHQL_HEADERS={"X-Custom-Header": "value"}

# SSL/TLS Certificate Verification (optional)
# Set to "false" to disable SSL certificate verification
# WARNING: Only use in development with self-signed certificates!
SSL_VERIFY=true

# Environment Type (REQUIRED for security controls)
# Options: production, development (default: production)
# Controls: SSL verification bypass, CORS defaults, security warnings
ENVIRONMENT=production

# HTTP Server Configuration
MCP_HOST=0.0.0.0
MCP_PORT=8000

# Logging Configuration
# Options: DEBUG, INFO, WARNING, ERROR (default: INFO)
LOG_LEVEL=INFO

# ============================================================================
# Security Configuration (NEW - December 2025)
# ============================================================================

# CORS Allowed Origins (REQUIRED in production)
# Comma-separated list of allowed origins for cross-origin requests
# If not set in production, ALL cross-origin requests will be blocked
# Examples:
#   ALLOWED_ORIGINS=https://app.example.com,https://admin.example.com
#   ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080
ALLOWED_ORIGINS=

# GraphQL Query Security Limits
# Prevents DoS attacks via oversized or deeply nested queries
MAX_QUERY_LENGTH=50000      # Maximum query size in characters (default: 50000)
MAX_QUERY_DEPTH=15          # Maximum nesting depth (default: 15)
MAX_QUERY_COMPLEXITY=1000   # Complexity score limit (default: 1000)

# Rate Limiting
# Rate limits are currently hard-coded per endpoint:
# - /tools: 60/minute
# - /execute: 30/minute
# - /auth/*: 10-20/minute
# Future: These will be configurable via environment variables

# Structured Logging (NEW)
# Enable JSON-formatted logging for SIEM/log aggregation systems
# Includes: timestamp, level, logger, message, user, client_ip, event_type
STRUCTURED_LOGGING=false

# Security Headers
# Automatically adds security headers to all responses:
# - HSTS (Strict-Transport-Security)
# - X-Content-Type-Options, X-Frame-Options, X-XSS-Protection
# - Content-Security-Policy (CSP)
# - Referrer-Policy, Permissions-Policy
# No configuration needed - enabled by default

# ============================================================================
# Additional Services (Docker Compose)
# ============================================================================
# Star Wars GraphQL Service
STARWARS_MCP_PORT=8001
STARWARS_GRAPHQL_ENDPOINT=https://swapi-graphql.netlify.app/graphql
STARWARS_AUTH_TOKEN=

# Huginn GraphQL Service
HUGINN_MCP_PORT=8008
HUGINN_GRAPHQL_ENDPOINT=https://app.local.huginn.energinet.local/graphql
HUGINN_AUTH_TOKEN=
HUGINN_SSL_VERIFY=false

# GitHub GraphQL Service (optional)
# GITHUB_MCP_PORT=8002
# GITHUB_TOKEN=your_github_token

# ============================================================================
# OAuth 2.1 Authentication (optional)
# ============================================================================
# OAuth 2.1 with PKCE support - more secure than basic OAuth
# Supports multiple providers: github, google, azure

# Enable OAuth 2.1 (default: false)
OAUTH_ENABLED=false

# OAuth Provider: github, google, azure (default: github)
OAUTH_PROVIDER=github

# OAuth 2.1 credentials (provider-agnostic)
OAUTH_CLIENT_ID=your_oauth_client_id
OAUTH_CLIENT_SECRET=your_oauth_client_secret
OAUTH_REDIRECT_URI=https://your-domain.com/auth/callback

# Access Control (optional - if not set, any authenticated user can access)
# Comma-separated list of allowed usernames
OAUTH_ALLOWED_USERS=user1,user2,user3

# Comma-separated list of allowed groups/organizations
OAUTH_ALLOWED_GROUPS=my-org,another-org

# Redis Token Storage (NEW - RECOMMENDED for production)
# Use Redis to store OAuth tokens across multiple instances
# If not set, uses in-memory storage (lost on restart)
# OAUTH_REDIS_URL=redis://redis:6379/1
# Note: If REDIS_URL is set, it will be used as fallback

# ============================================================================
# API Token Authentication (optional - alternative to OAuth)
# ============================================================================
# Static Bearer tokens for API/automation access
# Can be used alongside OAuth - API tokens are checked first

# Enable API token authentication (default: false)
API_TOKENS_ENABLED=false

# API Token Expiration (NEW - December 2025)
# Tokens now expire after specified seconds for security
# Default: 86400 seconds (24 hours)
API_TOKEN_EXPIRY=86400

# API tokens (comma-separated)
# Format 1: token:username pairs (uses API_TOKEN_EXPIRY)
# API_TOKENS=secret-token-123:automation-bot,another-token:ci-pipeline
#
# Format 2: token:username:ttl_seconds (custom TTL per token)
# API_TOKENS=secret-token-123:automation-bot:3600,another-token:ci-pipeline:86400
#
# Format 3: tokens only (uses "api-user" as default username)
# API_TOKENS=secret-token-123,another-token
#
# Generate secure tokens with:
#   python3 -c "import secrets; print(secrets.token_urlsafe(32))"
#   openssl rand -base64 32
#   uuidgen (less secure, but readable)
#
# Example with generated tokens:
# API_TOKENS=dG9rZW4xMjM0NTY3ODkwYWJjZGVm:ci-bot:7200,Rk2xN7vB9mQ3pL8wY1zA:deploy-service

# ============================================================================
# GitHub OAuth (Legacy - use OAuth 2.1 above for new deployments)
# ============================================================================
# These variables are still supported for backward compatibility
# Enable GitHub OAuth (default: false)
GITHUB_AUTH_ENABLED=false

# GitHub OAuth App credentials (required if auth enabled)
# Create an OAuth App at: https://github.com/settings/developers
GITHUB_CLIENT_ID=your_github_client_id
GITHUB_CLIENT_SECRET=your_github_client_secret

# OAuth callback URL (optional, auto-detected if not set)
# GITHUB_OAUTH_CALLBACK_URL=https://your-domain.com/auth/callback

# Access Control (optional - if not set, any authenticated GitHub user can access)
# Comma-separated list of allowed GitHub usernames
GITHUB_ALLOWED_USERS=user1,user2,user3

# Comma-separated list of allowed GitHub organizations
GITHUB_ALLOWED_ORGS=my-org,another-org

# Auth token expiry in seconds (default: 86400 = 24 hours)
AUTH_TOKEN_EXPIRY=86400

# ============================================================================
# Google OAuth (optional - requires OAUTH_PROVIDER=google)
# ============================================================================
# Create credentials at: https://console.cloud.google.com/apis/credentials
# GOOGLE_CLIENT_ID=your_google_client_id
# GOOGLE_CLIENT_SECRET=your_google_client_secret
# GOOGLE_REDIRECT_URI=https://your-domain.com/auth/callback

# ============================================================================
# Azure AD OAuth (optional - requires OAUTH_PROVIDER=azure)
# ============================================================================
# Register app at: https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps
# AZURE_CLIENT_ID=your_azure_client_id
# AZURE_CLIENT_SECRET=your_azure_client_secret
# AZURE_TENANT_ID=your_tenant_id_or_common
# AZURE_REDIRECT_URI=https://your-domain.com/auth/callback
